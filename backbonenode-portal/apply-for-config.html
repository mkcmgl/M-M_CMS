<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8">
    <link rel="shortcut icon" href="static/favicon.ico">
    <title>申请配置</title>
</head>
<script src="js/jquery.min.js" type="text/javascript"></script>
<script src="js/layer/layer.js" type="text/javascript"></script>
<script src="js/swiper.min.js" type="text/javascript"></script>
<script src="js/commonFn.js" type="text/javascript"></script>
<link href="css/swiper.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="css/main.css" />
<link rel="stylesheet" type="text/css" href="css/service-open.css" />

<body>
    <img src="static/back.png" class="noback" onclick="goback()" title="返回顶部" />
    <div class="wdf bg0 p101">
        <div class="wdf-flex tl">
            <a href="index.html">
                <img src="static/ykl.png" class="logol" />
            </a>
        </div>
        <div id="login-platform"></div>
    </div>
    <div class="disb posr w100 bgf6 drop-down-outer">
        <div class="ma posa bg07 toptab">
            <ul>
                <li class="fcolorf fs13 mr20 index1 proser1"><a href="">产品与服务</a></li>
                <div class="posa p101 ma z99 popupbody1">
                    <div class="popupmenu">
                        <div>
                            <div class="pb30 borderb pb20">
                                <ul>
                                    <li style="width: 32%"><span class="disb fb fs13 fcolor8c">区块链基础服务</span></li>
                                    <li style="width: 36%;"><span class="disb fb fs13 fcolor8c">区块链应用研发组件</span></li>
                                    <li style="width: 29%;"><span class="disb fb fs13 fcolor8c">应用场景</span></li>
                                </ul>
                            </div>
                            <div class="wdf p1303 options pt20">
                                <ul style="width: 32%;">
                                    <li class="disb"><a href="cpfw-kflml.html" target="_blank" class="mb15 fs13 fcolorf disb">开放联盟链</a></li>
                                    <li class="disb"><a href="cpfw-sylfw.html" target="_blank" class="mb15 fs13 fcolorf disb">私有链服务</a></li>
                                    <li class="disb"><a href="cpfw-lml.html" target="_blank" class="mb15 fs13 fcolorf disb">联盟链</a></li>
                                    <li class="disb"><a href="cpfw-qkljf.html" target="_blank" class="mb15 fs13 fcolorf disb">区块链积分</a></li>
                                </ul>
                                <ul style="width: 34%;margin-left: 10px;">
                                    <li class="disb"><a href="cpfw-znhykf.html" target="_blank" class="mb15 fs13 fcolorf disb">智能合约开发</a></li>
                                    <li class="disb"><a href="cpfw-mygl.html" target="_blank" class="mb15 fs13 fcolorf disb">密钥管理</a></li>
                                </ul>
                                <ul style="width: 31%;margin-left: 10px;">
                                    <li class="disb"><a href="cpfw-qklcz.html" target="_blank" class="mb15 fs13 fcolorf disb">区块链存证</a></li>
                                    <li class="disb"><a href="cpfw-gylgl.html" target="_blank" class="mb15 fs13 fcolorf disb">供应链管理</a></li>
                                    <li class="disb"><a href="cpfw-szhyx.html" target="_blank" class="mb15 fs13 fcolorf disb">数字化营销</a></li>
                                    <li class="disb"><a href="cpfw-qklsy.html" target="_blank" class="mb15 fs13 fcolorf disb">区块链溯源</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <li class="fcolorf fs13 disin proser mr20 index"><a href="">解决方案</a></li>
                <div class="posa p101 ma z99 popupbody">
                    <div class="popupmenu">
                        <div>
                            <div class="pb30 borderb pb20">
                                <ul>
                                    <li style="width: 30%"><span class="disb fb fs13 fcolor8c">企业服务</span></li>
                                    <li style="width: 32%;"><span class="disb fb fs13 fcolor8c">政务民生</span></li>
                                    <li style="width: 32%;"><span class="disb fb fs13 fcolor8c">其他行业</span></li>
                                </ul>
                            </div>
                            <div class="wdf p1303 options pt20">
                                <ul style="width: 29%;">
                                    <li class="disb"><a href="jjfa-zlts.html" target="_blank" class="mb15 fs13 fcolorf disb">质量提升</a></li>
                                    <li class="disb"><a href="jjfa-gyljr.html" target="_blank" class="mb15 fs13 fcolorf disb">供应链金融</a></li>
                                </ul>
                                <ul style="width: 33%;margin-left: 10px;">
                                    <li class="disb"><a href="jjfa-shgz.html" target="_blank" class="mb15 fs13 fcolorf disb">社会治理</a></li>
                                    <li class="disb"><a href="jjfa-sjbqyqz.html" target="_blank" class="mb15 fs13 fcolorf disb">数据保全与取证</a></li>
                                </ul>
                                <ul style="width: 32%;">
                                    <li class="disb"><a href="jjfa-kxtp.html" target="_blank" class="mb15 fs13 fcolorf disb">可信投票</a></li>
                                    <li class="disb"><a href="jjfa-kxcj.html" target="_blank" class="mb15 fs13 fcolorf disb">可信抽奖</a></li>
                                    <li class="disb"><a href="jjfa-sjbq.html" target="_blank" class="mb15 fs13 fcolorf disb">数字版权</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <li class="fcolorf fs13 mr20 index2"><a href="cpwd.html">产品文档</a></li>
                <li class="fcolorf fs13 mr20 index2"><a href="qyqy.html">生态企业</a></li>
                <li class="fcolorf fs13 mr20 index2"><a href="about.html">关于我们</a></li>
            </ul>
        </div>
    </div>

    <!-- 服务开通 -->
    <div class="service-open-outer">
        <div class="service-open-inner">
            <div class="so-return">
                <a href="javascript:history.go(-1)">&lt; 服务开通</a>
            </div>
            <div class="so-tabs flex-box">
                <a class="so-tab-item flex-box flex-column active" href="javascript:;" data-idx="001">
                    <img src="./static/sqpz/lml.png" alt="">
                    <span>联盟链</span>
                </a>
                <a class="so-tab-item flex-box flex-column" href="javascript:;" data-idx="002">
                    <img src="./static/sqpz/syl.png" alt="">
                    <span>私有链</span>
                </a>
                <a class="so-tab-item flex-box flex-column" href="javascript:;" data-idx="003">
                    <img src="./static/sqpz/kflml.png" alt="">
                    <span>开放联盟链</span>
                </a>
            </div>
            <div class="so-contents">
                <div class="so-contents-inner">
                    <div class="so-content-item">
                        <p class="des">发起联盟链，成为盟主，掌控的核心环境，包括Kafka、Orderer、盟主Peer、盟主CA等组件，并提供盟主管理员面板、在线命令行工具、监控工具、分析工具，可邀请更多企业及开发者加入其中</p>

                    </div>
                    <div class="so-content-item hide">
                        <p class="des">基于浪潮云容器平台（CKE），一键部署私有链，并提供管理员面板、运维工具</p>
                    </div>
                    <div class="so-content-item hide">
                        <p class="des">首次登录时，平台将赠送您1gwei的燃料，用于发起交易</p>
                        <p class="des">现有平台功能为新建链上用户，管理燃料，新建合约，部署合约等</p>
                    </div>
                </div>
                <div class="product-num flex-box">
                    <label>节点数量</label>
                    <span class="flex-box product-minus"> - </span>
                    <input type="text" class="product-input" value="1">
                    <span class="flex-box product-add"> + </span>
                </div>
                <!-- <div class="so-protocol flex-box">
                    <input type="checkbox" name="protocol" id="protocol" />
                    <label for="protocol">我已阅读并同意</label>
                    <a class="protocol-link" href="#">《渝快链开放服务平台开发者服务协议》</a>
                </div> -->
                <a href="javascript:;" class="so-btn">开通申请</a>
            </div>
        </div>
    </div>

    <div class="disb footer-two">
        <div class="bfbw80 marginauto">
            <ul class="wdf jcsb">
                <li class="w20">
                    <div>
                        <h4>渝快链</h4>
                        <ul>
                            <li class="fs14 mb10"><a href="about.html">简介</a></li>
                        </ul>
                    </div>
                </li>
                <li class="w20">
                    <div>
                        <h4>热门产品</h4>
                        <ul>
                            <li class="fs14 mb10"><a href="cpfw-kflml.html">开放联盟链</a></li>
                            <li class="fs14 mb10"><a href="cpfw-sylfw.html">私有链服务</a></li>
                            <li class="fs14 mb10"><a href="cpfw-gylgl.html">供应链管理</a></li>
                        </ul>
                    </div>
                </li>
                <li class="w20">
                    <div>
                        <h4>热门解决方案</h4>
                        <ul>
                            <li class="fs14 mb10"><a href="jjfa-zlts.html">质量提升</a></li>
                            <li class="fs14 mb10"><a href="jjfa-shgz.html">社会治理</a></li>
                        </ul>
                    </div>
                </li>
                <li class="w20">
                    <div>
                        <h4>生态企业</h4>
                        <ul>
                            <li class="fs14 mb10"><a href="stqy.html">生态企业展示</a></li>
                            <li class="fs14 mb10"><a href="stqyqy.html">生态企业权益</a></li>
                            <!-- <li class="fs14"><a href="">加入生态企业</a></li> -->
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
        <div class="bfbw80 marginauto footer-bottom">
            <p class="footercon fcolor8c">©2020 渝快链 All Rights Reserved<a href="http://beian.miit.gov.cn" target="_blank" class="ml20 fcolor8c">ICP备案：渝ICP备20006750号-1</a></p>
            <p class="footercon fcolor8c">版权所有：重庆浪潮云链信息技术有限公司</p>
        </div>
    </div>

    <!-- 开通申请提交成功弹窗 -->
    <div class="service-open-success" style="display: none;">
        <div class="so-success-inner">
            <a class="so-success-close icon flex-box" href="javascript:;">×</a>
            <div class="so-success-title">开通申请提交成功</div>
            <div class="so-success-des">前往 订单管理 查看申请开通情况</div>
            <div class="so-success-btn flex-box">
                <a href="javascript:;" class="so-success-jump flex-box btn">订单管理</a>
                <a href="javascript:;" class="so-success-close flex-box btn">关闭</a>
            </div>
        </div>
    </div>
</body>

</html>
<script>
    /* 回到顶部监控函数 */
    $(window).scroll(function() {
        let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        if (scrollTop > 500) {
            $(".noback").addClass("back");
            $(".noback").removeClass("noback");
        } else {
            $(".back").addClass("noback");
            $(".back").removeClass("back");
        }
    })

    function goback() {
        $("html,body").animate({
            scrollTop: 0
        }, 500);
    }
    /* 轮播 */
    let swiper = new Swiper('.swiper-container', {
        navigation: {
            nextEl: '.swiper-arrow-next',
            prevEl: '.swiper-arrow-prev',
        },
    });
    /* 强制添加hover */
    $('.popupbody').hover(function() {
        $('.index').css('backgroundColor', '#2186fb');
    }, function() {
        $('.index').css('backgroundColor', 'transparent');
    })
    $('.popupbody1').hover(function() {
        $('.index1').css('backgroundColor', '#2186fb');
    }, function() {
        $('.index1').css('backgroundColor', 'transparent');
    })

    /**
     * Ray
     */
    // 地址栏传参
    let hrefStr = location.search,
        hrefIdx = hrefStr.split("?idx=")[1];
    console.log(hrefIdx);
    if (hrefIdx && hrefIdx < 3) {
        console.log(hrefIdx);
        commonHandlerTab(hrefIdx);
    }

    // 新增事件
    $(document).on("click", ".so-tabs .so-tab-item", handleTabChange)
        .on("click", ".so-success-close", function() {
            $(".service-open-success").fadeOut();
        })
        .on("input", ".product-input", onlyNumber)
        .on("click", ".product-minus", function() {
            let inputVal = $(".product-input").val(),
                res = inputVal && inputVal > 1 ? (inputVal - 1) : 1;
            $(".product-input").val(res);
        })
        .on("click", ".product-add", function() {
            let inputVal = $(".product-input").val(),
                res = Number(inputVal) + 1;
            $(".product-input").val(res);
        })
        .on("click", ".so-btn", submitOpenServeOrder); // 开通申请

    // tab 切换
    function handleTabChange() {
        let _this = $(this),
            _idx = _this.index();
        commonHandlerTab(_idx);
    }

    function commonHandlerTab(_idx) {
        let contentItems = $(".so-contents-inner .so-content-item"),
            tabItems = $(".so-tabs .so-tab-item");

        if (_idx == 0) {
            $(".product-num").show();
        } else {
            $(".product-num").hide();
        }

        // _this.addClass("active").siblings().removeClass("active");
        tabItems.removeClass("active").eq(_idx).addClass("active");
        contentItems.hide().eq(_idx).show();
    }

    // 提交开通服务订单
    let ajaxFlag = false; // 防止多次触发请求

    function submitOpenServeOrder() {
        let struId = sessionStorage.getItem("struId"),
            token = sessionStorage.getItem("token");

        // TODO 判断登录状态
        if (!(struId && token)) {
            alert("请重新登录");
            return;
        }

        if (ajaxFlag) {
            return;
        }
        // 判断是否已阅读协议
        // let isChecked = $('#protocol').is(':checked');
        // if (!isChecked) {
        //     alert("请先阅读《渝快链开放服务平台开发者服务协议》");
        //     return;
        // }

        // 获取参数字段
        let _this = $(this),
            activeitem = $(".so-tab-item.active"),
            activeId = activeitem.attr("data-idx"),
            productNum = $(".product-num input").val();

        // 枚举: 001,002,003 // 枚举备注: 001 联盟链 002 私有链 003 开放联盟链
        let ajaxData = {
            struId: struId, // 租户id
            productId: activeId, // 产品id
        }

        // 节点数量 只有产品id 为 001 时必填
        if (activeId == '001') {
            if (!(productNum && productNum > 0)) {
                alert("请正确输入节点数量");
                return;
            }
            ajaxData["nodeNumber"] = productNum;
        }
        $.ajax({
            type: "POST",
            url: "/bcop/order/create", // 接口
            data: JSON.stringify(ajaxData),
            headers: {
                "Content-Type": "application/json; charset=utf-8",
                "Authorization": token
            },
            beforeSend: function() {
                ajaxFlag = true;
            },
            success: function(res) {
                console.log(res);
                if (res.success == "true") {
                    $(".service-open-success").fadeIn();
                } else {
                    layer.msg(res.msg);
                }
            },
            error: function(err) {
                alert(err);
            },
            complete: function() {
                ajaxFlag = false;
            }
        });
    }

    // utils
    function onlyNumber() {
        let inputVal = $(this).val();
        console.log(inputVal);
        //得到第一个字符是否为负号
        let t = inputVal.charAt(0);
        //先把非数字的都替换掉，除了数字和.和-号
        // inputVal = inputVal.replace(/[^\d\.\-]/g, '');
        //先把非数字的都替换掉
        inputVal = inputVal.replace(/[^\d]/g, '');
        //前两位不能是0加数字
        inputVal = inputVal.replace(/^0\d[0-9]*/g, '');
        //必须保证第一个为数字而不是.
        inputVal = inputVal.replace(/^\./g, '');
        //保证只有出现一个.而没有多个.
        inputVal = inputVal.replace(/\.{2,}/g, '.');
        //保证.只出现一次，而不能出现两次以上
        inputVal = inputVal.replace('.', '$#$').replace(/\./g, '').replace('$#$', '.');
        //如果第一位是负号，则允许添加
        inputVal = inputVal.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3');
        // if (t == '-') {
        //     return;
        // }
        $(this).val(inputVal)
    }
</script>